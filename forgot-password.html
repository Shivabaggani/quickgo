<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Forgot Password – QuickGo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial;
  background:#f3f4f6;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}
.box{
  background:#fff;
  padding:28px;
  width:320px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
}
h2{text-align:center;margin-bottom:15px;}
input{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  width:100%;
  padding:10px;
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
  margin-top:10px;
}
.hidden{display:none;}
</style>
</head>

<body>

<div class="box">
  <h2>Forgot Password</h2>

  <!-- STEP 1 -->
  <div id="step1">
    <input type="text" id="contact"
      placeholder="Enter email or mobile">
    <button onclick="sendResetOTP()">Send OTP</button>
  </div>

  <!-- STEP 2 -->
  <div id="step2" class="hidden">
    <input type="text" id="otp" placeholder="Enter OTP">
    <button onclick="verifyOTP()">Verify OTP</button>
  </div>

  <!-- STEP 3 -->
  <div id="step3" class="hidden">
    <input type="password" id="newPass"
      placeholder="New Password">
    <input type="password" id="confirmPass"
      placeholder="Confirm Password">
    <button onclick="resetPassword()">Reset Password</button>
  </div>
</div>

<script>
let resetUserIndex = null;

// STEP 1: SEND OTP
function sendResetOTP(){
  const contact = document.getElementById("contact").value.trim();
  let users = JSON.parse(localStorage.getItem("users")) || [];

  const userIndex = users.findIndex(u => u.contact === contact);
  if (userIndex === -1) {
    alert("User not found");
    return;
  }

  resetUserIndex = userIndex;

  const otp = Math.floor(100000 + Math.random() * 900000);
  localStorage.setItem("resetOTP", otp);

  alert("Your OTP is: " + otp + " (Demo)");

  document.getElementById("step1").classList.add("hidden");
  document.getElementById("step2").classList.remove("hidden");
}

// STEP 2: VERIFY OTP
function verifyOTP(){
  const entered = document.getElementById("otp").value.trim();
  const stored = localStorage.getItem("resetOTP");

  if (entered !== stored) {
    alert("Invalid OTP");
    return;
  }

  localStorage.removeItem("resetOTP");

  document.getElementById("step2").classList.add("hidden");
  document.getElementById("step3").classList.remove("hidden");
}

// STEP 3: RESET PASSWORD
function resetPassword(){
  const newPass = document.getElementById("newPass").value;
  const confirm = document.getElementById("confirmPass").value;

  if (newPass.length < 6) {
    alert("Password must be at least 6 characters");
    return;
  }

  if (newPass !== confirm) {
    alert("Passwords do not match");
    return;
  }

  let users = JSON.parse(localStorage.getItem("users")) || [];
  users[resetUserIndex].password = btoa(newPass);

  localStorage.setItem("users", JSON.stringify(users));

  alert("Password reset successful ✔");
  window.location.href = "login.html";
}
</script>

</body>
</html>
