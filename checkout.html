<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checkout ‚Äì QuickGo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial;
  background: #f3f6fb;
}

/* HEADER */
header {
  background: #60a5fa;
  color: #fff;
  padding: 14px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.back-btn {
  background:#fff;
  color:#2563eb;
  border:none;
  border-radius:6px;
  padding:6px 10px;
  font-weight:bold;
  cursor:pointer;
}

/* CARD */
.card {
  background: #fff;
  margin: 14px;
  padding: 14px;
  border-radius: 14px;
  box-shadow:0 8px 18px rgba(0,0,0,.08);
}

.cart-item {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}

/* ‚ûï‚ûñ ADDED QTY BUTTONS (ONLY ADDITION) */
.qty-box{
  display:flex;
  align-items:center;
  gap:8px;
}

.qty-box button{
  width:26px;
  height:26px;
  border:none;
  border-radius:6px;
  background:#2563eb;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}

.qty-box span{
  min-width:20px;
  text-align:center;
  font-weight:bold;
}

/* PAYMENT */
.payment label {
  display:block;
  margin:8px 0;
}

input[type="text"]{
  width:100%;
  padding:8px;
  margin-top:6px;
}

/* PLACE ORDER */
.place-order {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: #fff;
  padding: 12px;
  box-shadow:0 -4px 12px rgba(0,0,0,.15);
}

.place-order button {
  width: 100%;
  padding: 14px;
  background: #2563eb;
  color: #fff;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: bold;
}
</style>
</head>

<body>

<!-- HEADER -->
<header>
  <button class="back-btn" onclick="goBack()">‚Üê Back</button>
  <h3>Checkout</h3>
  <button class="back-btn" onclick="goHome()">üè† Home</button>
</header>

<!-- CART -->
<div class="card">
  <h3>Your Items</h3>
  <div id="cartItems"></div>
</div>

<!-- PAYMENT -->
<div class="card payment">
  <h3>Payment Method</h3>

  <label>
    <input type="radio" name="pay" value="upi" checked>
    UPI
  </label>
  <input type="text" id="upiId" placeholder="example@upi">

  <label>
    <input type="radio" name="pay" value="cod">
    Cash on Delivery
  </label>
</div>

<!-- BILL -->
<div class="card">
  <h3>Bill Details</h3>
  <p>Item Total: ‚Çπ<span id="itemTotal">0</span></p>
  <p>Delivery Fee: ‚Çπ30</p>
  <p>GST (5%): ‚Çπ<span id="gst">0</span></p>
  <p><b>To Pay: ‚Çπ<span id="grandTotal">0</span></b></p>
</div>

<div class="place-order">
  <button onclick="placeOrder()">Pay & Place Order</button>
</div>

<script>
// üîê LOGIN CHECK
if (localStorage.getItem("isLoggedIn") !== "true") {
  location.href = "login.html";
}

// üîô BACK
function goBack(){
  if (history.length > 1) history.back();
  else location.href = "index.html";
}

// üè† HOME
function goHome(){
  location.replace("food.html");
}

// üõí CART
let cart = JSON.parse(localStorage.getItem("cart")) || [];
const cartItems = document.getElementById("cartItems");

function renderCart(){
  if (!cart.length) {
    cartItems.innerHTML = "<p>Your cart is empty</p>";
    updateBill(0);
    return;
  }

  let total = 0;
  cartItems.innerHTML = "";

  cart.forEach((i, index) => {
    total += i.price * i.qty;

    cartItems.innerHTML += `
      <div class="cart-item">
        <span>${i.name}</span>

        <!-- ‚ûï‚ûñ ADDED BUTTONS -->
        <div class="qty-box">
          <button onclick="changeQty(${index}, -1)">‚àí</button>
          <span>${i.qty}</span>
          <button onclick="changeQty(${index}, 1)">+</button>
        </div>

        <span>‚Çπ${i.price * i.qty}</span>
      </div>
    `;
  });

  updateBill(total);
}

function changeQty(index, delta){
  cart[index].qty += delta;

  if (cart[index].qty <= 0) {
    cart.splice(index, 1); // remove item
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function updateBill(total){
  let gst = Math.round(total * 0.05);
  document.getElementById("itemTotal").innerText = total;
  document.getElementById("gst").innerText = gst;
  document.getElementById("grandTotal").innerText = total + gst + 30;
}

renderCart();

// üí≥ PAYMENT CHECK
function getPayment(){
  return document.querySelector('input[name="pay"]:checked').value;
}

function validateUPI(){
  const upi = document.getElementById("upiId").value.trim();
  return /^[a-zA-Z0-9.\-_]{2,}@[a-zA-Z]{2,}$/.test(upi);
}

// üßæ PLACE ORDER
function placeOrder(){
  if (!cart.length) {
    alert("Cart is empty");
    return;
  }

  const pay = getPayment();
  if (pay === "upi" && !validateUPI()) {
    alert("Enter valid UPI ID");
    return;
  }

  const order = {
    items: cart,
    payment: pay,
    status: 0,
    time: Date.now()
  };

  localStorage.setItem("lastOrder", JSON.stringify(order));
  localStorage.removeItem("cart");
  localStorage.removeItem("cartCount");

  alert("Order placed successfully ‚úî");
  location.href = "order-tracking.html";
}
</script>

</body>
</html>
